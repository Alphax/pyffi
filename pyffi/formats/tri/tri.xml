<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fileformat>
<fileformat>

    <!--
    *******************
    *** basic types ***
    *******************
    -->

    <basic name="ubyte">
        An unsigned 8-bit integer.
    </basic>

    <basic name="byte">
        A signed 8-bit integer.
    </basic>

    <basic name="ushort">
        An unsigned 16-bit integer.
    </basic>

    <basic name="short">
        A signed 16-bit integer.
    </basic>

    <basic name="uint">
        An unsigned 32-bit integer.
    </basic>

    <basic name="int">
        A signed 32-bit integer.
    </basic>

    <basic name="char">
        An 8-bit character.
    </basic>

    <basic name="float">
        A standard 32-bit floating point number.
    </basic>

    <!--
    *******************
    *** alias types ***
    *******************
    -->

    <!--
    ******************
    *** enum types ***
    ******************
    -->

    <!--
    ******************
    *** bitstructs ***
    ******************
    -->

    <!--
    ***************
    *** structs ***
    ***************
    -->

   <struct name="Vertex">
       <add name="x" type="float"/>
       <add name="y" type="float"/>
       <add name="z" type="float"/>
   </struct>

   <struct name="TriFace">
       <add name="v1" type="int"/>
       <add name="v2" type="int"/>
       <add name="v3" type="int"/>
   </struct>

   <struct name="QuadFace">
       Not used by the Oblivion engine as it's tri based.
       <add name="v1" type="int"/>
       <add name="v2" type="int"/>
       <add name="v3" type="int"/>
       <add name="v4" type="int"/>
   </struct>

   <struct name="TexCoord">
       <add name="U" type="float"/>
       <add name="V" type="float"/>
   </struct>
   <struct name="ShortRelativeVertex">
       <add name="x" type="short"/>
       <add name="y" type="short"/>
       <add name="z" type="short"/>
   </struct>

   <struct name="MorphRecord">
       A modifier replaces the vertices from the base model in
       VertexList with those in the ModifierVertexPool.  The
       ModiferVertexPool counts up from the first modifier onwards. So
       if you were to take the 4th vertex to be modified in the 2nd
       Modifier and the size of the 1st was 10 vertices. You would
       read the modified value from the 14th record of the
       ModifierVertexPool. Therefore NumModifierVertices = sum of the
       ModifierList[].NumVerticesToModify.
       <add name="NameSize" type="short">
	   Size of the morph's name in bytes including the 0 terminator.
       </add>
       <add name="Name" type="char" arr1="NameSize">
           Name of the morph. Zero terminated.
       </add>
       <add name="Scale" type="float">
           All the following relative vertices are multiplied by this scale.
       </add>
       <add name="Vertices" type="ShortRelativeVertex" arr1="ARG">
           Amount to alter the base model corresponding vertex by.
       </add>
   </struct>

    <struct name="Header">
        <add name="Signature" type="FileSignature">FRTRI</add>
        <add name="Version" type="FileVersion">003 for Oblivion</add>
        <add name="Num Vertices" type="int">Number of vertices in the base model.</add>
        <add name="Num Tri Faces" type="int"> Number of 3 sided faces in the model.</add>
        <add name="Num Quad Faces" type="int"> Number of 4 sided faces in the model. Always 0 for Oblivion.</add>
        <add name="Unknown1" type="int"> Always 0.</add>
        <add name="Unknown2" type="int"> Always 0.</add>
        <add name="Num UV Vertices" type="int"> Number of UV vertices in model.</add>
        <add name="Has UV" type="int"> Does the model have texture UV. Always 1.</add>
        <add name="Num Morphs" type="int"> Number of relative morphs</add>
        <add name="Num Modifiers" type="int"> Number of absolute morphs</add>
        <add name="Num Modifier Vertices" type="int"> Number of vertices that are changed by all the modifiers.</add>
        <add name="Unknown3" type="int"> Always 0.</add>
        <add name="Unknown4" type="int"> Always 0.</add>
        <add name="Unknown5" type="int"> Always 0.</add>
        <add name="Unknown6" type="int"> Always 0.</add>
    </struct>

    <struct name="Data">
       <add name="Vertices" type="Vertex" arr1="Num Vertices">
            List of vertices for base model. Indexed from 0.
       </add>
       <add name="Modifier Vertex Pool" type="Vertex" arr1="Num Modifier Vertices">
            List of vertices that modify the base model. Indexed from 0.
       </add>
       <add name="Tri Faces" type="TriFace" arr1="Num Tri Faces"> List of 3 sided faces. Each point is indexed to VertexList.</add>
       <add name="Quad Faces" type="QuadFace" arr1="Num Quad Faces"> List of 4 sided faces. Each point is indexed to VertexList. Not used by Oblivion.</add>
       <add name="UVs" type="TexCoord" arr1="Num UVs"> List of vertices for the UV of the base model.</add>
       <add name="UV Tri Faces" type="TriFace" arr1="Num Tri Faces" cond="Has UV">List of 3 sided UV faces. Each point is Indexed to UVVertexList. Only used if HasUV=1.</add>
       <add name="UV Quad Faces" type="QuadFace" arr1="NumQuadFaces" cond="Has UV"> List of 4 sided UV faces. Each point is Indexed to UVVertexList. Only used if HasUV=1.</add>
       <add name="Morphs" type="MorphRecord" arr1="Num Morphs" arg="Num Modifiers"> List of morphs.</add>
       <!-- TODO: ModifierRecord
       <add name="Modifiers" type="ModifierRecord" arr1="Num Modifiers"> List of modifiers.</add>
       -->
     </struct>

</fileformat>
