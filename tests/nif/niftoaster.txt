Doctests for the niftoaster script
==================================

The --help switch
-----------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--help"]
>>> try:
...     niftoaster.NifToaster().cli()
... except SystemExit: # --help uses sys.exit()
...     pass
Usage: niftoaster.py [options] <spell1> <spell2> ... <file>|<folder>
<BLANKLINE>
Apply the spells <spell1>, <spell2>, and so on, on <file>, or recursively on
<folder>.
<BLANKLINE>
Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  --help-spell          show help specific to the given spells
  --examples            show examples of usage and exit
  --spells              list all spells and exit
  -a ARG, --arg=ARG     pass argument ARG to each spell
  -x EXCLUDE, --exclude=EXCLUDE
                        exclude block type EXCLUDE from spell; exclude
                        multiple block types by specifying this option more
                        than once
  -i INCLUDE, --include=INCLUDE
                        include only block type INCLUDE in spell; if this
                        option is not specified, then all block types are
                        included except those specified under --exclude;
                        include multiple block types by specifying this option
                        more than once
  -r, --raise           raise exception on errors during the spell; useful for
                        debugging spells
  --noninteractive      run a non-interactive session (overwrites files
                        without warning)
  -v VERBOSE, --verbose=VERBOSE
                        verbosity level: 0, 1, or 2 [default: 1]
  -p, --pause           pause when done
  --dry-run             for spells that modify files, save the modification to
                        a temporary file instead of writing it back to the
                        original file; useful for debugging spells
  --prefix=PREFIX       for spells that modify files, prepend PREFIX to file
                        name
  --diff                instead of writing back the file, write a binary patch
  --patch               apply all binary patches
  --diff-cmd=DIFFCMD    use ARG as diff command; this command must accept
                        precisely 3 arguments, oldfile, newfile, and
                        patchfile.
  --patch-cmd=PATCHCMD  use ARG as patch command; this command must accept
                        precisely 3 arguments, oldfile, newfile, and
                        patchfile.
  --series              run spells in series rather than in parallel

The --examples switch
---------------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--examples"]
>>> niftoaster.NifToaster().cli() # doctest: +REPORT_NDIFF
* check if PyFFI can read all files in current directory
  (python version of nifskope's xml checker):
<BLANKLINE>
    python niftoaster.py check_read .
<BLANKLINE>
* optimize all nif files a directory tree, recursively
<BLANKLINE>
    python niftoaster.py optimize /path/to/your/nifs/
<BLANKLINE>
* print texture information of all nif files a directory tree, recursively
<BLANKLINE>
    python niftoaster.py dump_tex /path/to/your/nifs/
<BLANKLINE>
* update/generate mopps of all nif files a directory tree, recursively
<BLANKLINE>
    python niftoaster.py updatemopp /path/to/your/nifs/
<BLANKLINE>
* update/generate skin partitions of all nif files a directory tree,
recursively, for Freedom Force vs. The 3rd Reich
<BLANKLINE>
    python niftoaster.py ffvt3rskinpartition /path/to/your/nifs/
<BLANKLINE>
* run the profiler on PyFFI while reading nif files:
<BLANKLINE>
    python -m cProfile -s cumulative -o profile_read.txt niftoaster.py read .
<BLANKLINE>
* find out time spent on a particular test:
<BLANKLINE>
    python -m cProfile -s cumulative niftoaster.py tristrip
<BLANKLINE>
* merge skeleton roots and rest positions for all files in current directory:
<BLANKLINE>
    python niftoaster.py mergeskelandrestpos .
<BLANKLINE>
* scale all files in c:\zoo2 by a factor 100 - useful to
  visualize nif files from games such as Zoo Tycoon 2 that are otherwise too
  small to show up properly in nifskope:
<BLANKLINE>
    python niftoaster.py -a 100 scale "c:\zoo2"
<BLANKLINE>

The --spells switch
-------------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--spells"]
>>> niftoaster.NifToaster().cli()
check_read
check_readwrite
check_nodenamesbyflag
check_compareskindata
check_bhkbodycenter
check_centerradius
check_convexverticesshape
checkmopp
checkskincenterradius
checkskinpartition
checktangentspace
checktristrip
disableparallax
dump
dump_tex
dump_htmlreport
exportpixeldata
fix_addtangentspace
fix_clampmaterialalpha
fix_deltangentspace
fix_detachhavoktristripsdata
fix_ffvt3rskinpartition
fix_texturepath
fix_sendgeometriestobindposition
fix_sendbonestobindposition
fix_strip
hackcheckskindata
hackmultiskelroot
hackskindataidtransform
hackskinrestpose
mergeskelandrestpos
opt_cleanreflists
opt_mergeduplicates
opt_geometry
optimize
optimize_split
scale
updatecenterradius
updatemopp
updateskinpartition

The check_readwrite spell and the --raise switch
------------------------------------------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--verbose=1", "--raise", "check_readwrite", "tests/nif/"]
>>> niftoaster.NifToaster().cli() # doctest: +ELLIPSIS
Traceback (most recent call last):
    ...
NifError: unknown block type 'NiInvalid!'
>>> sys.argv = ["niftoaster.py", "--verbose=1", "check_readwrite", "tests/nif/"]
>>> niftoaster.NifToaster().cli() # doctest: +ELLIPSIS +REPORT_NDIFF
pyffi.toaster:INFO:=== tests/nif/invalid.nif ===
pyffi.toaster:ERROR:TEST FAILED ON tests/nif/invalid.nif
pyffi.toaster:ERROR:If you were running a spell that came with PyFFI, then
pyffi.toaster:ERROR:please report this as a bug (include the file) on
pyffi.toaster:ERROR:http://sourceforge.net/tracker/?group_id=199269
pyffi.toaster:INFO:=== tests/nif/test.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_centerradius.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_convexverticesshape.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_dump_tex.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_fix_clampmaterialalpha.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_fix_detachhavoktristripsdata.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_fix_ffvt3rskinpartition.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_fix_tangentspace.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_fix_texturepath.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_opt_dupgeomdata.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_opt_dupverts.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_opt_emptyproperties.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:=== tests/nif/test_opt_mergeduplicates.nif ===
pyffi.toaster:INFO:  --- check_readwrite ---
pyffi.toaster:INFO:    writing to temporary file
pyffi.toaster:INFO:      comparing file sizes
pyffi.toaster:INFO:Finished.

The check_bhkbodycenter spell
-----------------------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--verbose=1", "--raise", "check_bhkbodycenter", "tests/nif/test_fix_detachhavoktristripsdata.nif"]
>>> niftoaster.NifToaster().cli() # doctest: +ELLIPSIS
pyffi.toaster:INFO:=== tests/nif/test_fix_detachhavoktristripsdata.nif ===
pyffi.toaster:INFO:  --- check_bhkbodycenter ---
pyffi.toaster:INFO:    ~~~ NiNode [MiddleWolfRug01] ~~~
pyffi.toaster:INFO:      ~~~ NiTriStrips [MiddleWolfRug01:0] ~~~
pyffi.toaster:INFO:        ~~~ bhkCollisionObject [] ~~~
pyffi.toaster:INFO:          ~~~ bhkRigidBodyT [] ~~~
pyffi.toaster:INFO:            getting rigid body mass, center, and inertia
pyffi.toaster:INFO:            recalculating...
pyffi.toaster:INFO:            checking center...
pyffi.toaster:WARNING:center does not match; original [  0.000  0.000  0.000  0.000 ], calculated [ -1.085 18.465  6.887  0.000 ]
pyffi.toaster:INFO:            checking inertia...
pyffi.toaster:INFO:Finished.

The check_centerradius spell
----------------------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--verbose=1", "--raise", "check_centerradius", "tests/nif/test_centerradius.nif"]
>>> niftoaster.NifToaster().cli() # doctest: +ELLIPSIS
pyffi.toaster:INFO:=== tests/nif/test_centerradius.nif ===
pyffi.toaster:INFO:  --- check_centerradius ---
pyffi.toaster:INFO:    ~~~ NiNode [test] ~~~
pyffi.toaster:INFO:      ~~~ NiTriShape [Cube] ~~~
pyffi.toaster:INFO:        ~~~ NiTriShapeData [] ~~~
pyffi.toaster:INFO:          getting bounding sphere
pyffi.toaster:INFO:          checking that all vertices are inside
pyffi.toaster:WARNING:not all vertices inside bounding sphere (vertex [ 10.000 -10.000 -10.000 ], error 7.91647286717)
pyffi.toaster:INFO:          recalculating bounding sphere
pyffi.toaster:INFO:          comparing old and new spheres
pyffi.toaster:WARNING:center does not match; original [ -1.000 -0.000  0.000 ], calculated [  0.000 -0.000  0.000 ]
pyffi.toaster:WARNING:radius does not match; original 10.0, calculated 17.32...
pyffi.toaster:INFO:Finished.

The check_convexverticesshape spell
-----------------------------------

>>> import sys
>>> sys.path.append("scripts/NIF")
>>> import niftoaster
>>> sys.argv = ["niftoaster.py", "--verbose=1", "--raise", "check_convexverticesshape", "tests/nif/test_convexverticesshape.nif"]
>>> niftoaster.NifToaster().cli() # doctest: +ELLIPSIS
pyffi.toaster:INFO:=== tests/nif/test_convexverticesshape.nif ===
pyffi.toaster:INFO:  --- check_convexverticesshape ---
pyffi.toaster:INFO:    ~~~ NiNode [Scene Root] ~~~
pyffi.toaster:INFO:      ~~~ bhkCollisionObject [] ~~~
pyffi.toaster:INFO:        ~~~ bhkRigidBody [] ~~~
pyffi.toaster:INFO:          ~~~ bhkConvexVerticesShape [] ~~~
pyffi.toaster:INFO:            checking vertices and planes
pyffi.toaster:ERROR:vertex [  0.000  0.000  1.500 ] does not intersect with any plane
pyffi.toaster:INFO:      ~~~ NiTriStrips [Sphere] ~~~
pyffi.toaster:INFO:Finished.

